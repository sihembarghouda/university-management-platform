import axios from 'axios';

const AUTH_API_URL = process.env.REACT_APP_AUTH_API_URL || 'http://localhost:3000/api';

/**
 * Service pour g√©rer l'authentification avec notre backend
 */
const authService = {
  /**
   * Demander un lien de r√©initialisation de mot de passe
   * @param {string} email - L'email de l'utilisateur
   */
  async requestPasswordReset(email) {
    try {
      console.log('üîê [Password Reset] Demande de r√©initialisation pour:', email);
      
      const response = await axios.post(`${AUTH_API_URL}/auth/forgot-password`, { email });
      
      console.log('‚úÖ [Password Reset] Email envoy√© avec succ√®s!');
      
      return {
        success: true,
        message: response.data.message || 'Un email de r√©initialisation a √©t√© envoy√©'
      };
    } catch (error) {
      console.error('‚ùå [Password Reset] Erreur:', error);
      throw error;
    }
  },

  /**
   * R√©initialiser le mot de passe avec email, token et nouveau mot de passe
   * @param {string} email - L'email de l'utilisateur
   * @param {string} token - Le token de r√©initialisation
   * @param {string} newPassword - Le nouveau mot de passe
   */
  async resetPassword(email, token, newPassword) {
    try {
      console.log('üîê [Reset Password] R√©initialisation pour:', email);
      
      const response = await axios.post(`${AUTH_API_URL}/auth/reset-password`, {
        email,
        token,
        newPassword
      });
      
      console.log('‚úÖ [Reset Password] Mot de passe r√©initialis√© avec succ√®s!');
      
      return {
        success: true,
        message: response.data.message || 'Mot de passe r√©initialis√© avec succ√®s'
      };
    } catch (error) {
      console.error('‚ùå [Reset Password] Erreur:', error);
      throw error;
    }
  },

  /**
   * Se connecter avec email et mot de passe
   * @param {string} email - L'email de l'utilisateur
   * @param {string} password - Le mot de passe
   */
  async login(email, password) {
    try {
      console.log('üîë [Login] Tentative de connexion pour:', email);
      
      const response = await axios.post(`${AUTH_API_URL}/auth/login`, {
        email,
        password
      });
      
      console.log('‚úÖ [Login] Connexion r√©ussie!');
      
      return response.data;
    } catch (error) {
      console.error('‚ùå [Login] Erreur:', error);
      throw error;
    }
  }
};

export default authService;
